{
  "hash": "98ce9be3d18db2ea49e6a2dcb9454176",
  "result": {
    "markdown": "---\ntitle: \"Describing Relationships\"\nsubtitle: \"R for Data Analysis<br>Session 3\"\ntitle-slide-attributes:\n  data-background-size: stretch\n  data-slide-number: none\nauto-stretch: false\ninstitute: \"University of Mannheim<br>Fall 2023\"\nauthor: \"Viktoriia Semenova\"\nfooter: \"[ðŸ”— r4da.live](https://r4da.live/)\"\nlogo: images/logo.png\nformat:\n  revealjs:\n    theme: slides.scss\n    transition: fade\n    incremental: true   \n    slide-number: true\n    chalkboard: true\neditor: visual\nexecute:\n  echo: true\n---\n\n\n\n\n# Intro \n\n## Plan for Today\n\n- Organisation & Homework Issues \n- Refresher on quantifying relationships between variables \n- More visualization with `ggplot2` and some data wrangling with `dplyr`\n\n## Organisation\n\n- Start problem sets earlier (come on Monday if you have questions/problems!)\n- By next Wednesday class (September 27, 2023) find teammates \n  - 2-3 people per group \n  - Problem sets will ask for explicit contributions from both \n  - You can still work on your own if you strongly prefer that \n\n## Workflow: Projects  \n\n- Make sure you are in the correct project: \n  - you cannot push to `r4da-labs`, only to your problem sets \n  - if you are _not_ in a project, you may not have the *Git* pane \n- Project knows your working directory, you don't need the `setwd()` \n- Do not multiply `problem_set.qmd` (or other) files \n  - the whole point of `git` is to prevent that from happening\n  - commit and push regularly and if you need a previous version of your project, you can find it in history \n  \n## Workflow: Naming {.smaller}\n\n- Object names must:\n  - start with a letter\n  - can only contain letters, numbers, `_`, and `.`\n  - be be descriptive\n  \n- `janitor` package helps with cleaning the variable names in datasets \n  - `clean_names`\n\n\n## Workflow: Git {.smaller}\n\n![](https://ohi-science.org/assets/blog_images/workflow.jpg)\n\n- `git` does not track some of the files in your folders/repos\n  - untracked files are listed in `.gitignore`\n  - you can edit this file if necessary \n- GitHub blocks files larger than 100 MB \n  - Do not commit large files \n  - Add large files' names to `.gitignore`, commit the updated `.gitignore` file\n\n\n##  Workflow: Code Style {.smaller}\n\n> Good coding style is like correct punctuation: you can manage without it, butitsuremakesthingseasiertoread.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nun_votes %>% \n  filter(un_votes > 5, issue == \"Human rights\")\n\nun_votes %>% filter(un_votes > 5, issue == \"Human rights\")\n\nun_votes %>% \n  filter(un_votes > 5, \n         issue == \"Human rights\")\n\nun_votes %>% filter(un_votes>5,issue==\"Human rights\")\n\nun_votes %>% \n  filter(un_votes > 5,       issue == \"Human rights\")\n```\n:::\n\n\n##  Workflow: Code Style Tools {.smaller}\n\n1. Select the code inside the chunk \n2. Use **CTRL/CMD + SHIFT + A** \n\nThere are also packages like `styler` that allow you to style the entire file or even all files in a directory:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninstall.packages(\"styler\")\nlibrary(styler)\n```\n:::\n\n\nEspecially when rendering to PDF, you will want to make sure that your code is not getting cut off on the page. `lint` package shows you which lines are problematic so that you can adjust them (as well as many other things):\n\n\n::: {.cell}\n\n```{.r .cell-code}\ninstall.packages(\"lint\")\nlibrary(lint)\n```\n:::\n\n\nMore on styling [on course website](https://r4da.live/resource/style.html)\n\n\n\n## Quiz: Using Packages {.smaller}\n\n- What is the difference between these lines of code?\n- Which lines print out the dataset but not store the object in the environment?\n- Which lines require installed `readr` package and which do not? \n- Which lines require loaded `readr` package and which do not? \n\n\n::: {.cell}\n\n```{.r .cell-code}\nreadr::read_csv(\"data/beauty.csv\")\n\ndf <- read_csv(\"data/beauty.csv\")\n\nbeauty <- read_csv(\"/Users/vktrsmnv/Desktop/r4da/website/data/beauty.csv\")\n\ndf <- read.csv(\"data/beauty.csv\")\n```\n:::\n\n\n\n## Quiz: Plots {.smaller}\n\n::: columns\n::: {.column width=\"50%\"}\n### Plot A\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(\n  data = governors,\n  mapping = aes(\n    x = year,\n    y = lived_after\n  )\n)\n+\n  geom_point(alpha = 0.5)\n```\n:::\n\n\n::: \n::: {.column width=\"50%\"}\n\n### Plot B\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot() +\n  geom_point(\n    governors, \n    aes(\n      x = year, \n      y = lived_after\n      ),\n    alpha = 0.5\n  )\n```\n:::\n\n  \n::: \n::: \n  \n\n# Association and Relationships \n\n## Conditional (Marginal) Distributions\n\nA *conditional distribution* is the distribution of one variable given the value of another variable\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](03-slides_files/figure-revealjs/unnamed-chunk-8-1.png){width=960}\n:::\n:::\n\n\n<!-- ## Cookies and Happiness -->\n\n\n\n\n<!-- ![](https://theeffectbook.net/the-effect_files/figure-html/describingrelationships-smoking-1.png) -->\n<!-- ![](https://r4da.live/files/img/assignments/prior_attitudes_balance.png) -->\n\n## Conditional Means\n\n- Summarizes conditional distributions  \n- Conditional expectation $E[Y|X]$: \n    - Expected (typical/average) $Y$, given the value of $X$ \n- Independence (no relationship) $E[Y|X] = E[Y]$:\n    - \"Knowing $X$ doesn't affect my expectation of $Y$\"\n    - Learning about $X$ does not help us to predict $Y$\n    - Our best guess remains the typical value of $Y$ \n\n\n::: {.cell}\n::: {.cell-output-display}\n|treatment | att_start_mn| att_end_mn|\n|:---------|------------:|----------:|\n|Control   |     8.859375|   8.453125|\n|Treated   |     9.607843|  10.000000|\n:::\n:::\n\n\n## Does Time of Day Help Predict Happiness? \n\n::: columns\n\n::: {.column width=\"50%\"}\n\n::: {.cell}\n\n```{.r .cell-code}\ncookies_data\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 10 Ã— 3\n   happiness cookies time     \n       <dbl>   <int> <chr>    \n 1       0.5       1 Morning  \n 2       2         2 Morning  \n 3       1         3 Morning  \n 4       2.5       4 Morning  \n 5       3         5 Morning  \n 6       1.5       6 Afternoon\n 7       2         7 Afternoon\n 8       2.5       8 Afternoon\n 9       2         9 Afternoon\n10       3        10 Afternoon\n```\n:::\n:::\n\n\n::: \n\n::: {.column width=\"50%\"}\n\n::: {.cell}\n\n```{.r .cell-code}\ncookies_data %>%\n  group_by(time) %>% \n  summarise_all(mean)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 Ã— 3\n  time      happiness cookies\n  <chr>         <dbl>   <dbl>\n1 Afternoon       2.2       8\n2 Morning         1.8       3\n```\n:::\n:::\n\n\n::: \n\n::: \n\n# Relationships\n\n## What Does it Mean to Be Related?\n\n-   We would consider two variables to be *related* if knowing something about one of them tells you something about the other\n-   Variables are *dependent* on each other if telling you the value of one gives you information about the distribution of the other\n-   Variables are *correlated* if knowing whether one of them is unusually high gives you information about whether the other is unusually high (positive correlation) or unusually low (negative correlation)\n-   Explaining one variable Y with another X means *predicting* your Y by looking at the distribution of Y for your value of X\n\n## Which of These Statements Describe Correlations/Relationships?\n\n1.  Voters who donate money to political candidates are usually wealthy.\n2.  Cities with more crime tend to hire more police officers.\n3.  Female legislators on average speak more emotionally about women-related issues as compared to male parliamentarians.\n4.  Most candidate who win political office received a lot of campaign donations.\n\n\n# Measuring Association\n\n## Covariance\n\n$$Cov(X,Y) = \\frac{\\overbrace{\\sum^N_{i = 1}\\overbrace{(X_i - \\bar{x})}^{\\text{Deviation of }X_i\\\\\\text{from mean of X}} \\times\\overbrace{(Y_i-\\bar{y})}^{\\text{Deviation of }Y_i\\\\\\text{from mean of Y}}}^{\\text{Sum of the product of the deviations}\\\\\\text{across all observations}}}{\\underbrace{N}_{\\text{Number of observations}}}$$\n\n-   conveys information about co-occurrence of the values in variables\n-   positive values indicate direct relationship (positive correlation)\n-   negative values indicate inverse relationship (negative correlation)\n\n## Covariance: Example\n\n::: columns\n\n::: {.column width=\"50%\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nx <- c(4, 13, 19, 25, 29, 10, 30)\ny <- c(10, 12, 28, 32, 38, 35, 11)\ndata <- data.frame(x, y)\nknitr::kable(data)\n```\n\n::: {.cell-output-display}\n|  x|  y|\n|--:|--:|\n|  4| 10|\n| 13| 12|\n| 19| 28|\n| 25| 32|\n| 29| 38|\n| 10| 35|\n| 30| 11|\n:::\n:::\n\n\n:::\n\n::: {.column width=\"50%\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata %>%\n  summarise_all(mean)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n         x        y\n1 18.57143 23.71429\n```\n:::\n\n```{.r .cell-code}\ncov(x, y)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 37.85714\n```\n:::\n:::\n\n\n:::\n\n::: \n\n\n## Covariance: Illustration\n\n::: r-stack\n<!-- ::: fragment -->\n<!-- ##### Scatterplot  -->\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](03-slides_files/figure-revealjs/unnamed-chunk-14-1.png){width=960}\n:::\n:::\n\n<!-- ::: -->\n\n::: fragment\n<!-- ##### Add Mean of X -->\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](03-slides_files/figure-revealjs/unnamed-chunk-15-1.png){width=960}\n:::\n:::\n\n:::\n\n::: fragment\n<!-- ##### Add Mean of Y -->\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](03-slides_files/figure-revealjs/unnamed-chunk-16-1.png){width=960}\n:::\n:::\n\n:::\n\n::: fragment\n<!-- ##### Calculate the Deviations from Mean of X -->\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](03-slides_files/figure-revealjs/unnamed-chunk-17-1.png){width=960}\n:::\n:::\n\n:::\n\n::: fragment\n<!-- ##### Calculate the Deviations from Mean of Y -->\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](03-slides_files/figure-revealjs/unnamed-chunk-18-1.png){width=960}\n:::\n:::\n\n:::\n\n::: fragment\n<!-- ##### Multiply the Deviations -->\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](03-slides_files/figure-revealjs/unnamed-chunk-19-1.png){width=960}\n:::\n:::\n\n:::\n\n::: fragment\n<!-- ##### Product Sign Tells How X & Y Move Relative to Their Means -->\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](03-slides_files/figure-revealjs/unnamed-chunk-20-1.png){width=960}\n:::\n:::\n\n:::\n\n::: fragment\n\n::: {.cell}\n::: {.cell-output-display}\n![](03-slides_files/figure-revealjs/unnamed-chunk-21-1.png){width=960}\n:::\n:::\n\n:::\n:::\n\n<!-- :::  -->\n\n<!-- :::  -->\n\n## Correlation Coefficient\n\n$$corr(X,Y)=\\frac{Cov(X,Y)}{\\underbrace{\\sigma_X}_{\\text{Standard }\\\\\\text{Deviation }\\\\\\text{of X}}\\underbrace{\\sigma_Y}_{\\text{Standard}\\\\\\text{Deviation}\\\\\\text{of Y}}}$$\n\n-   rescaled covariance to $corr(X,Y) \\in [-1,1]$: extreme values indicate stronger relationship\n-   sometimes denoted by letter $r$\n-   says nothing about *how much* $Y$ changes when $X$ changes\n-   has no units and will not be affected by a linear change in the units (e.g., going from centimeters to inches)\n\n## Correlation Values\n\n\\\n\n::: columns\n::: {.column width=\"50%\"}\n| r         | Rough meaning |\n|-----------|---------------|\n| Â±0.1--0.3 | Modest        |\n| Â±0.3--0.5 | Moderate      |\n| Â±0.5--0.8 | Strong        |\n| Â±0.8--0.9 | Very strong   |\n:::\n\n::: {.column width=\"50%\"}\n\n::: {.cell fig.dim='[4.8,4.2]'}\n::: {.cell-output-display}\n![](03-slides_files/figure-revealjs/correlation-grid-1.png){width=100%}\n:::\n:::\n\n:::\n:::\n\n\n## Correlograms\n\n::: columns\n::: {.column width=\"50%\"}\n\n### Heatmaps\n\n::: {.cell}\n::: {.cell-output-display}\n![](03-slides_files/figure-revealjs/cor-heatmap-1.png){width=100%}\n:::\n:::\n\n::: \n::: {.column width=\"50%\"}\n\n### Points\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](03-slides_files/figure-revealjs/cor-points-1.png){width=100%}\n:::\n:::\n\n\n::: \n:::\n\n## Slope of the Regression Line \n\n$$\\beta_X = \\frac{Cov(X,Y)}{\\underbrace{\\sigma_X}_{\\text{Standard }\\\\\\text{Deviation }\\\\\\text{of X}}}$$\n\n> How much $Y$ changes, on average, as $X$ increases by one unit\n\n\n# Regression Line as Conditional Mean\n\n## Cookies and Happiness (again)\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](03-slides_files/figure-revealjs/unnamed-chunk-22-1.png){width=960}\n:::\n:::\n\n\n\n# Goal: Draw a line that approximates the relationship {.smaller}\n\n\n## Prediction Ignoring Number of Cookies Eaten\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](03-slides_files/figure-revealjs/cookies-no-info-1.png){width=100%}\n:::\n:::\n\n\n## Fitting the Line Through Every Observation\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](03-slides_files/figure-revealjs/cookies-spline-1.png){width=100%}\n:::\n:::\n\n\n## LOESS Curve\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](03-slides_files/figure-revealjs/cookies-loess-1.png){width=100%}\n:::\n:::\n\n\n## OLS Regression Line\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](03-slides_files/figure-revealjs/cookies-lm-1.png){width=100%}\n:::\n:::\n\n\n## Regression Line Explains Variance in Y with X\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](03-slides_files/figure-revealjs/unnamed-chunk-23-1.png){width=100%}\n:::\n:::\n\n\n## Explained vs. Unexplained Variance \n\n::: r-stack\n\n::: fragment\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](03-slides_files/figure-revealjs/unnamed-chunk-24-1.png){width=100%}\n:::\n:::\n\n\n:::\n::: fragment\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](03-slides_files/figure-revealjs/unnamed-chunk-25-1.png){width=100%}\n:::\n:::\n\n\n:::\n::: fragment\n\n::: {.cell}\n::: {.cell-output-display}\n![](03-slides_files/figure-revealjs/unnamed-chunk-26-1.png){width=100%}\n:::\n:::\n\n:::\n:::\n\n\n# Visualizing Relationships\n\n## The Dangers of Dual y-axes\n\n<figure>\n\n<img src=\"images/dual-axis.png\" title=\"Spurious correlation between divorce rate and margarine consumption\" alt=\"Spurious correlation between divorce rate and margarine consumption\" width=\"100%\"/>\n\n<figcaption>Source: <a href=\"https://www.tylervigen.com/spurious-correlations\" target=\"_blank\">Tyler Vigen's spurious correlations</a></figcaption>\n\n</figure>\n\n## The Problem: Too Much Freedom\n\n-   We have to choose where the y-axes start and stop\n-   We can force the two trends to line up however we want\n\n<!-- ## Relationships and Two Axis -->\n\n<!-- ![](images/two-y-by-four-sm.jpeg) -->\n\n## Example from *The Economist*\n\n<br> <!-- ::: columns -->\n\n<!-- ::: {.column width=\"50%\"} -->\n\n![](https://datavizs22.classes.andrewheiss.com/slides/img/07/economist-dogs.png) <!-- ::: -->\n\n<!-- ::: {.column width=\"50%\"} -->\n\n<!-- ![](images/PS01_by_wday.png) -->\n\n<!-- ::: -->\n\n<!-- ::: -->\n\n## Fine When They Measure the Same Thing\n\n\n::: {.cell fig.dim='[8,3.5]'}\n::: {.cell-output-display}\n![](03-slides_files/figure-revealjs/atl-weather-dual-nice-1.png){width=100%}\n:::\n:::\n\n\n## Adding a second scale in `ggplot2`\n\n::: columns\n::: {.column width=\"50%\"}\n\n::: {.cell}\n::: {.cell-output-display}\n![](03-slides_files/figure-revealjs/unnamed-chunk-27-1.png){width=480}\n:::\n:::\n\n:::\n\n::: {.column width=\"50%\"}\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(\n  weather,\n  aes(x = datetime, y = tempmax)\n) +\n  geom_line() +\n  geom_smooth() +\n  scale_y_continuous(\n    sec.axis =\n      sec_axis(\n        trans = ~ (. * 9 / 5) + 32,\n        name = \"Fahrenheit\"\n      )\n  ) +\n  labs(\n    x = NULL, y = \"Celsius\",\n    title = \"Daily high temperatures in Mannheim\",\n    subtitle = \"January 1 2021â€“December 31, 2021\",\n    caption = \"Source: visualcrossing.com\"\n  )\n```\n:::\n\n:::\n:::\n\n## Adding a second scale in `ggplot2`\n\n::: columns\n::: {.column width=\"50%\"}\n\n::: {.cell}\n::: {.cell-output-display}\n![](03-slides_files/figure-revealjs/unnamed-chunk-29-1.png){width=480}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ngov\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 Ã— 2\n  party       total\n  <chr>       <int>\n1 Democrat      557\n2 Republican    527\n3 Third party     8\n```\n:::\n:::\n\n:::\n\n::: {.column width=\"50%\"}\n\n::: {.cell}\n\n```{.r .cell-code}\ngov <- governors %>%\n  group_by(party) %>%\n  summarize(total = n())\n\nggplot(\n  gov,\n  aes(\n    x = party, y = total,\n    fill = party\n  )\n) +\n  geom_col() +\n  scale_y_continuous(\n    sec.axis = sec_axis(\n      trans = ~ . / sum(gov$total),\n      labels = scales::percent\n    )\n  ) +\n  guides(fill = \"none\") +\n  scale_fill_viridis_d()\n```\n:::\n\n:::\n:::\n\n## Alternative: Use Multiple Plots\n\n::: columns\n::: {.column width=\"60%\"}\n\n::: {.cell}\n::: {.cell-output-display}\n![](03-slides_files/figure-revealjs/unnamed-chunk-32-1.png){width=960}\n:::\n:::\n\n:::\n\n::: {.column width=\"40%\"}\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(patchwork)\ntemp_plot <- ggplot(\n  weather,\n  aes(x = datetime, y = tempmax)\n) +\n  geom_line() +\n  geom_smooth() +\n  labs(\n    x = NULL,\n    y = \"Temperature (ÂºC)\"\n  )\n\nhumid_plot <- ggplot(\n  weather,\n  aes(x = datetime, y = humidity)\n) +\n  geom_line() +\n  geom_smooth() +\n  labs(\n    x = NULL,\n    y = \"Humidity (%)\"\n  )\n\ntemp_plot + humid_plot +\n  plot_layout(\n    ncol = 1,\n    heights = c(0.7, 0.3)\n  )\n```\n:::\n\n:::\n:::\n\n## Getting Lab Material {.smaller}\n\n-   Open `r4da-labs.Rproj` file to open the *labs* project.\n-   Go into *Git* pane.\n-   If there are any files you changed, you will see them in the window.\n    -   Select all these files.\n    -   Click on *Commit*, write a commit message, and save it.\n    -   If you click on *Push*, it will give you a `git` error message\\\n-   Click on *Pull* to get the new files uploaded.\n\n",
    "supporting": [
      "03-slides_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}