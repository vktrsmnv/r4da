{
  "hash": "1af36801c60c94d2df0c7576d291ef84",
  "result": {
    "markdown": "---\ntitle: \"Fixed Effects\" \nsubtitle: \"Data Analytics and Visualization with R<br>Session 11\" \ntitle-slide-attributes:\n  data-background-size: stretch\n  data-slide-number: none\nauto-stretch: false\ninstitute: \"University of Mannheim<br>Spring 2023\"\nauthor: \"Viktoriia Semenova\"\nfooter: \"[ðŸ”— r4da.live](https://r4da.live/)\"\nlogo: images/logo.png\nformat:\n  revealjs:\n    theme: ../slides.scss\n    transition: fade\n    incremental: true   \n    slide-number: true\n    chalkboard: true\nexecute:\n  echo: true\neditor_options: \n  chunk_output_type: console\neditor: \n  markdown: \n    wrap: 80\n---\n\n\n\n\n# Intro\n\n## Housekeeping\n\n- Evaluations have started! Please check your email for details!\n- New deadline for PS10: Wednesday May 10, 23:59\n- You need to pass 10 problem sets (not all ~~13~~ 12)\n- Which topics to review in the last week: [ask your questions here](https://viktoriiasemenova.typeform.com/to/JMDJOtYg)\n\n\n## Quiz: Which of these statements are correct?\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n```{=html}\n<div class=\"countdown\" id=\"timer_76903b12\" data-update-every=\"1\" tabindex=\"0\" style=\"right:0;bottom:0;\">\n<div class=\"countdown-controls\"><button class=\"countdown-bump-down\">&minus;</button><button class=\"countdown-bump-up\">&plus;</button></div>\n<code class=\"countdown-time\"><span class=\"countdown-digits minutes\">04</span><span class=\"countdown-digits colon\">:</span><span class=\"countdown-digits seconds\">00</span></code>\n</div>\n```\n:::\n:::\n\n\n\n1. If there is no overlap in joint distributions of the matching variables, then it would not be possible to find a match, hence (exact) matching would not work.\n\n2. Propensity score depicts the probability of the unit being treated predicted with the main dependent variable.\n\n3. Matching works through adding the variation in confounders so that the relationship between $X$ and $Y$ can only be attributed to the variation in $X$.\n\n4. Matching requires some correlation between the treatment assignment and the potential outcomes for it to work properly.\n\n5. In comparison to regression, matching would provide a more accurate estimate to treatment effect when there is a non-linear relationship in the data.\n\n## Common Support Assumption\n\n::: columns\n::: {.column width=\"50%\"}\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](11-fixed-effects_files/figure-revealjs/unnamed-chunk-2-1.png){fig-align='center' width=2100}\n:::\n:::\n\n\n:::\n::: {.column width=\"50%\"}\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](11-fixed-effects_files/figure-revealjs/unnamed-chunk-3-1.png){fig-align='center' width=2100}\n:::\n:::\n\n\n:::\n:::\n\n\n## Matching is Non-parametric\n\n::: columns\n::: {.column width=\"50%\"}\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](11-fixed-effects_files/figure-revealjs/unnamed-chunk-4-1.png){fig-align='center' width=2100}\n:::\n:::\n\n\n:::\n::: {.column width=\"50%\"}\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nm1 <- lm(y ~ d + x, data = df)\nconfint(m1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                 2.5 %     97.5 %\n(Intercept) 0.60253035 0.70733015\nd           0.13179296 0.24538616\nx           0.01373668 0.05222461\n```\n:::\n\n```{.r .cell-code}\ncem_df <- matchit(d ~ x,\n                  data = df,\n                  method = \"cem\") %>%\n  match.data()\nm2 <- lm(y ~ d + x, data = cem_df,\n         weights = weights)\nconfint(m2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                   2.5 %      97.5 %\n(Intercept) -0.176066150 -0.07082210\nd            0.915051908  1.03682727\nx            0.009702613  0.04379835\n```\n:::\n:::\n\n:::\n:::\n\n\n# Fixed Effects\n\n\n## Recap\n\n- So far we talked about two ways to isolate the relationship between $X$ and $Y$, i.e.  blocking back doors to identify an effect\n  - **Statistical control**: use $W$ to explain our $X$ and $Y$ variables, then work with the residuals\n  - **Matching**: restrict the data so that observations only have similar values in $W$ and compare _within_ these values\n\n- In both cases, we assumed that we have the necessary variables to close the back doors (i.e. we assume _conditional independence_)\n  - Either everything was measured or we have everything needed measured\n- But what if there are things we need to control but we cannot measure/observe them?\n\n## DAG: We Cannot Close All Paths\n\n\n\n```{dot}\n//| echo: false\n//| fig-width: 7\n//| fig-asp: 0.7\n//| out-width: 100%\ndigraph D {\n  node [shape=ellipse];\n  edge [len = 1.2, arrowhead = vee];\n  a [label = \"Treatment\"];\n  b [label = \"Outcome\"];\n  c [label = \"Confounder\"];\n  d [label = \"Unobserved\", style = \"dashed\"];\n  e [label = \"Unmeasured\", style = \"dashed\"];\n\n  {rank=same a b};\n  {rank=same d e};\n  {rank=sink d};\n  {rank=source a};\n  a->b;\n  c->a;\n  c->b;\n  d->c;\n  d->b;\n  e->b;\n  e->a;\n}\n```\n\n\n## Our Solution: Fixed Effects\n\n- If we observe each *person*/*party*/*country*/etc. multiple times, then we can forget about controlling for the actual back-door variable weâ€™re interested in\n- And just control for  *person*/*party*/*country*/etc. identity instead!\n- This will control for **everything** unique to that individual, whether we can measure it or not!\n\n## Fixed Effects Illustration\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](11-fixed-effects_files/figure-revealjs/unnamed-chunk-7-1.png){fig-align='center' width=2100}\n:::\n:::\n\n\n\n\n## Example: GDP per capita and Life Expectancy\n\n<br>\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(gapminder) # built-in dataset\ndata(gapminder) # load data from it\nglimpse(gapminder)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 1,704\nColumns: 6\n$ country   <fct> \"Afghanistan\", \"Afghanistan\", \"Afghanistan\", \"Afghanistan\", \"Afghanistâ€¦\n$ continent <fct> Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asiaâ€¦\n$ year      <int> 1952, 1957, 1962, 1967, 1972, 1977, 1982, 1987, 1992, 1997, 2002, 2007â€¦\n$ lifeExp   <dbl> 28.801, 30.332, 31.997, 34.020, 36.088, 38.438, 39.854, 40.822, 41.674â€¦\n$ pop       <int> 8425333, 9240934, 10267083, 11537966, 13079460, 14880372, 12881816, 13â€¦\n$ gdpPercap <dbl> 779.4453, 820.8530, 853.1007, 836.1971, 739.9811, 786.1134, 978.0114, â€¦\n```\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# remove the means\ngapminder <- gapminder %>%\n  group_by(country) %>%\n  mutate(\n    lifeExp_c = lifeExp - mean(lifeExp),\n    logGDP_c = log(gdpPercap) - mean(log(gdpPercap))\n  ) %>%\n  ungroup()\n\n# compare correlations\ncor(gapminder$lifeExp, log(gapminder$gdpPercap))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.8076179\n```\n:::\n\n```{.r .cell-code}\ncor(gapminder$lifeExp_c, gapminder$logGDP_c)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.6404051\n```\n:::\n:::\n\n\n## Gapminder Illustration\n\n::: columns\n::: {.column width=\"50%\"}\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](11-fixed-effects_files/figure-revealjs/unnamed-chunk-10-1.png){fig-align='center' width=2100}\n:::\n:::\n\n:::\n::: {.column width=\"50%\"}\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](11-fixed-effects_files/figure-revealjs/unnamed-chunk-11-1.png){fig-align='center' width=2100}\n:::\n:::\n\n\n:::\n:::\n\n## We Control For Multiple Confounders at Once\n\n\n```{dot}\n//| echo: false\n//| fig-width: 7\n//| fig-asp: 0.7\n//| out-width: 100%\ndigraph D {\n  node [shape=ellipse];\n  edge [len = 1.2, arrowhead = vee];\n  a [label = \"GDP per capita\"];\n  b [label = \"Life Expectancy\"];\n  c [label = \"Political\\nInstitutions\"];\n  d [label = \"History\"];\n  e [label = \"Economic\\nInstitutions\"];\n  f [label = \"War\"];\n  g [label = \"Pandemic\"];\n\n  {rank=same a b};\n  {rank=same d e};\n  {rank=sink d};\n  {rank=source c f g};\n  a->b;\n  c->a;\n  c->b;\n  d->a;\n  d->b;\n  e->b;\n  e->a;\n  f->b;\n  f->a;\n  g->b;\n  g->a;\n}\n```\n\n\n- If these factors stay constant within country, we don't need a big long list of back doors.\n\n## Control for Country\n\n\n```{dot}\n//| echo: false\n//| fig-width: 7\n//| fig-asp: 0.7\n//| out-width: 100%\ndigraph D {\n  node [shape=ellipse];\n  edge [len = 1.2, arrowhead = vee];\n  a [label = \"GDP per capita\"];\n  b [label = \"Life Expectancy\"];\n  d [label = \"Country\"];\n\n  {rank=same a b};\n  {rank=sink d};\n  a->b;\n  d->a;\n  d->b;\n}\n```\n\n\n\n## How Fixed Effects Work\n\n- Ignoring the baseline differences between Germany, Britain, China, etc., in their GDP per capita and life expectancy, and just looking within each country\n- We are comparing countries _to themselves_ at different time periods\n- We are ignoring all differences *between* countries and looking only at differences *within* countries\n- Fixed Effects is sometimes also referred to as the _\"within estimator\"_\n\n::: task\n\n- **Within variation:** variation that occurs _within_ an individual (usually) across different periods of time. \\\n- **Between variation:** variation of a variable that occurs _between_ different individuals, usually at the same period of time, or comparing over-time averages.\n:::\n\n## Within Variation: One Country\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](11-fixed-effects_files/figure-revealjs/unnamed-chunk-14-1.png){fig-align='center' width=2100}\n:::\n:::\n\n\n## Regression Equations for Fixed Effects\n\n$$\n\\text{Life Expectancy}_{it}  = \\beta_{i} + \\beta_1 \\cdot \\text{GDP per capita}_{it} +  \\varepsilon_{it}\n$$\n\n$$\n\\text{Life Expectancy}_{it}  = \\beta_0 + \\beta_1 \\cdot \\text{GDP per capita}_{it} + \\beta_2 \\cdot \\text{Country}_{it} + \\varepsilon_{it}\n$$\n\n\n- Subscript $it$ indicates that the data varies both between countries ($i$) and over time ($t$)\n- The intercept term has a subscript $i$ instead of an $0$, making it $\\beta_{i}$\n- Units in the data are constrained to have the same slope (thereâ€™s no $i$ subscript on $\\beta_2$), but they have different intercepts\n\n\n## Interpretation \n\n$$\n\\text{Life Expectancy}_{it}  = \\beta_0 + \\beta_1 \\cdot \\text{GDP per capita}_{it} + \\beta_2 \\cdot \\text{Country}_{it} + \\varepsilon_{it}\n$$\n\n- If we have fixed effects for country, we are comparing that country to itself over time\n- And if we had fixed effects for continent, we are comparing country in that continent only to other country in that continent\n- We can include more than one FE where needed \n\n## Pooled Ordinary Least Squares \n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](11-fixed-effects_files/figure-revealjs/unnamed-chunk-15-1.png){fig-align='center' width=2100}\n:::\n:::\n\n\n## With Country Fixed Effects\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](11-fixed-effects_files/figure-revealjs/unnamed-chunk-16-1.png){fig-align='center' width=2100}\n:::\n:::\n\n\n\n\n## When to Use Fixed Effects\n\n- *Panel data*: refers to situations where the number of time periods is quite short and the number of units quite high. \n  - NES panel is like this: 2000 respondents asked questions at various points in time over\nthe course of an election (or multiple elections).\n- *Time-series cross-sectional data*: has fewer units and many time periods (e.g., U.S. states over time or Western European countries over time)\n\n\n## Two-way Fixed Effects \n\n- We can include multiple fixed effects in one equation, e.g. for  \n- *Two-way fixed effects* is common for TSCS data\n  - FE for both *individual* and *time*  \n\n$$\nY_{it} = \\beta_i + \\beta_t + \\beta_1X_{it} + \\varepsilon_{it}\n$$\n\n- Here we are looking at variation *within* individual as well as *within* year, i.e. the variation thatâ€™s left as being variation relative to _what we'd expect given that individual, and given that year_\n- Estimator focuses more heavily on individuals that have a lot of variation over time\n\n##  Clustered Standard Errors\n\n- Regression assumption: error terms are independent of each other, but with hierarchical data, this is likely violated \n- _Clustered SEs_ account for any sort of correlation between errors _within_ each grouping, e.g. country \n- Including a control for a group indicator in the model vs. clustering at that group level are different but often complimentary\n  - The indicator variable suggests that group membership is an important _predictor_ of the outcome and possibly on an important back door\n  - Clustering suggests that group membership is related to the _ability of the model to predict_ well\n- Good practice: use theory and/or cluster at the level of treatment\n- Often clustered SEs are default implementation  \n\n  \n## What Fixed Effects Do Not Fix\n\n- Reverse causality (e.g., crime rates vs. police spending per capita)\n- Time-variant unobserved heterogeneity (e.g., war or pandemic)\n- Fixed effects framework does not straightforwardly extend to non-linear models, especially when the number of groups is large \n  - Approach 1: Use OLS \n  - Approach 2: Look for implementations, such as `feglm()`/`fenegbin()` in `fixest` package \n  \n## Factor Varies Over Time\n\n\n```{dot}\n//| echo: false\n//| fig-width: 7\n//| fig-asp: 0.7\n//| out-width: 100%\ndigraph D {\n  node [shape=ellipse];\n  edge [len = 1.2, arrowhead = vee];\n  a [label = \"GDP per capita\"];\n  b [label = \"Life Expectancy\"];\n  d [label = \"Country\"];\n  e [label = \"War\"];\n\n  {rank=same a b};\n  {rank=sink d};\n  a->b;\n  d->a;\n  d->b;\n  e->a;\n  e->b;\n}\n```\n\n\n- Solution: include *War* into regression model\n\n\n## Example\n\n- Suppose you want to know the effect of a teacher on the test scores of high school students\n- Some potential back doors might go through: *parents' intelligence*, *age*, *demographics*, *school*, *last year's teacher*\n- If you used fixed effects for students, what back doors would still be open?\n\n\n\n<!-- ## Example: Train Delays  -->\n\n<!-- ![](https://www.journals.uchicago.edu/na101/home/literatum/publisher/uchicago/journals/content/jop/2018/jop.2018.80.issue-4/698754/20180920/images/large/tb1_1.jpeg) -->\n\n\n\n\n\n\n\n## Main Takeaways\n\n- Fixed Effects is essentially a dummy variable regression\n- It is useful for panel data (i.e. when we have repeated observations across units) and it allows us to isolate the effect _within_ individuals\n- Fixed effects combines together lots of different **constant-within-country** back doors into something that lets us identify the model even if we canâ€™t measure them all\n- Use clustered SEs when working with FEs\n\n\n\n",
    "supporting": [
      "11-fixed-effects_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/countdown-0.4.0/countdown.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/countdown-0.4.0/countdown.js\"></script>\n"
      ],
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}